<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>РАСКРОЙ СВОЙ КРИСТАЛЛ ДУШИ</title>

<!-- стили -->
<style>
  :root{
    --bg:#0f1220; --panel:#141b3a; --ink:#eef3ff; --muted:#9fb0d8;
    --accent:#2d6ae0; --pill:#26335e; --ring:#34406a;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:980px;margin:auto;padding:22px}
  h1{margin:6px 0 18px;text-align:center;line-height:1.2;
     font-weight:800;font-size:clamp(24px,4.5vw,44px)}
  .glow{color:#ffd966;text-shadow:0 0 6px #ffebb0,0 0 12px #ffd966,0 0 22px #ffcc33}
  .panel{background:var(--panel);border-radius:16px;padding:16px;margin:14px 0}
  .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
  .field{display:flex;align-items:center;gap:8px;background:#101735;border:1px solid var(--ring);
         padding:10px 12px;border-radius:10px}
  .field span{font-size:14px;color:var(--muted)}
  input[type="date"], select{background:transparent;border:0;color:var(--ink);font-size:16px}
  button{appearance:none;border:0;border-radius:12px;padding:12px 18px;font-weight:700;cursor:pointer}
  .primary{background:var(--accent);color:#fff}
  .secondary{background:#3b476f;color:#fff}
  .badge{display:inline-block;background:#1a244d;border:1px solid var(--ring);
         border-radius:999px;padding:8px 14px;margin:6px 0}
  .matrix{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;max-width:460px;margin:16px auto}
  .cell{border-radius:14px;padding:28px 0;text-align:center;font-weight:800;font-size:24px;
        color:#00110d;box-shadow:0 8px 20px rgba(0,0,0,.28)}
  /* палитра 1..12 */
  .c1 {background:#ff6b6b}.c2 {background:#ff994d}.c3 {background:#ffd54d}
  .c4 {background:#b8ff6e}.c5 {background:#24a148;color:#eafff5}.c6 {background:#9ee5ff}
  .c7 {background:#5294ff;color:#eef6ff}.c8 {background:#cfe5ff}.c9  {background:#9b6cff;color:#fff}
  .c10{background:#cba6ff}.c11{background:#ff78c6}.c12{background:#ffc7d7}
  .cards{display:grid;gap:12px}
  .card h3{margin:4px 0 10px;text-align:center}
  .codes p{margin:6px 0}
  .howto p{margin:8px 0 12px}
  .muted{color:var(--muted)}
  .row{display:flex;gap:6px;justify-content:center;flex-wrap:wrap}
  .pill{background:var(--pill);border:1px solid var(--ring);border-radius:999px;padding:8px 12px}
</style>

<!-- jsPDF для PDF -->
<script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
<div class="wrap">

  <h1 id="title">
    РАСКРОЙ СВОЙ <span class="glow">КРИСТАЛЛ ДУШИ</span>
  </h1>

  <!-- панель ввода -->
  <div class="panel">
    <div class="controls">
      <label class="field">
        <span id="t_birthdate">Дата рождения</span>
        <input type="date" id="date">
      </label>
      <label class="field">
        <span id="t_language">Язык</span>
        <select id="lang">
          <option value="ru">Русский</option>
          <option value="en">English</option>
        </select>
      </label>
      <button class="primary" id="btnCalc">Рассчитать</button>
      <button class="secondary" id="btnPdf">Скачать PDF</button>
    </div>
  </div>

  <!-- ВЫ и матрица -->
  <div class="row"><div class="badge" id="vyBadge"></div></div>
  <div class="matrix" id="matrix"></div>

  <!-- Коды и инструкция -->
  <div class="cards">
    <div class="panel codes" id="codes"></div>
    <div class="panel howto" id="howto"></div>
  </div>

</div>

<script>
/* ======= локализация ======= */
let LANG = 'ru';
const tr = {
  ru: {
    title: 'РАСКРОЙ СВОЙ <span class="glow">КРИСТАЛЛ ДУШИ</span>',
    birthdate: 'Дата рождения',
    language: 'Язык',
    calc: 'Рассчитать',
    pdf: 'Скачать PDF',
    vy: v => `Уровень Высшего Я: ${v}`,
    codesTitle: 'Троичные коды',
    torsion: 'Активация торсионного поля',
    light: 'Активация тела света',
    soul: 'Активация индивидуальной души',
    howtoTitle: 'Инструкция к кодам',
    a1: '1) АКТИВАЦИЯ КРИСТАЛЛА ДУШИ',
    a1_1: n => `«Вдыхаю Свет — Выдыхаю Любовь»: ладони в намасте, вдох из центра головы в Высшее сердце, выдох с раскрытием рук золотым светом. N1 = ${n} раз.`,
    a1_2: n => `«Вдыхаю Силу — Выдыхаю Волю»: вдох из солнечного сплетения к Тимусу, выдох золотого света на раскрытых руках. N2 = ${n} раз.`,
    a1_3: n => `Простукивание точки Тимуса со звуком «аа». N3 = ${n} раз.`,
    a2: '2) ЗАПУСК ТОРСИОННОГО ПОЛЯ',
    a2_1: n => `Верхняя воронка: вращение по часовой стрелке, руки вверх. T1 = ${n} раз.`,
    a2_2: n => `Нижняя воронка: вращение против часовой стрелки, руки вниз. T2 = ${n} раз.`,
    a2_3: n => `Гармонизация: руки в намасте на груди и лёгкие прыжки (или перекат с пяток на носки). T3 = ${n} раз.`,
    a3: '3) ИНТЕГРАЦИЯ ТЕЛА СВЕТА',
    a3_1: n => `Одновременные круги руками вперёд. C1 = ${n} раз.`,
    a3_2: n => `Одновременные круги руками назад. C2 = ${n} раз.`,
    a3_3: n => `Фиксация: ладони в намасте на груди, мягкое надавливание ладонями друг на друга. C3 = ${n} раз.`,
    codeLine: (ttl,a,b,c)=> `<p><b>${ttl}:</b> <span class="pill">${a}</span> <span class="pill">${b}</span> <span class="pill">${c}</span></p>`,
    pdfFile: d => `Kristall_${d}.pdf`,
    dateLabel: 'Дата'
  },
  en: {
    title: 'REVEAL YOUR <span class="glow">SOUL CRYSTAL</span>',
    birthdate: 'Birth date',
    language: 'Language',
    calc: 'Calculate',
    pdf: 'Download PDF',
    vy: v => `Higher Self Level: ${v}`,
    codesTitle: 'Trinity Codes',
    torsion: 'Torsion Field Activation',
    light: 'Light Body Activation',
    soul: 'Individual Soul Activation',
    howtoTitle: 'Instructions',
    a1: '1) SOUL CRYSTAL ACTIVATION',
    a1_1: n => `“I breathe in Light — I breathe out Love”: palms in namaste, inhale from head center to the Higher Heart, exhale with arms wide, radiating golden light. N1 = ${n} times.`,
    a1_2: n => `“I breathe in Power — I breathe out Will”: inhale from solar plexus to the Thymus, exhale golden light with open arms. N2 = ${n} times.`,
    a1_3: n => `Tap the Thymus point while vocalizing “aa”. N3 = ${n} times.`,
    a2: '2) TORSION FIELD LAUNCH',
    a2_1: n => `Upper vortex: clockwise spin, hands up. T1 = ${n} times.`,
    a2_2: n => `Lower vortex: counter-clockwise spin, hands down. T2 = ${n} times.`,
    a2_3: n => `Harmonization: hands in namaste at the chest and gentle jumps (or heel-to-toe pulses). T3 = ${n} times.`,
    a3: '3) LIGHT BODY INTEGRATION',
    a3_1: n => `Both hands circles forward. C1 = ${n} times.`,
    a3_2: n => `Both hands circles backward. C2 = ${n} times.`,
    a3_3: n => `Fixation: palms in namaste on the chest, soft pressing palms to each other. C3 = ${n} times.`,
    codeLine: (ttl,a,b,c)=> `<p><b>${ttl}:</b> <span class="pill">${a}</span> <span class="pill">${b}</span> <span class="pill">${c}</span></p>`,
    pdfFile: d => `Crystal_${d}.pdf`,
    dateLabel: 'Date'
  }
};
const T = k => tr[LANG][k];

/* ======= утилиты ======= */
const byId = id => document.getElementById(id);
const ds = n => { // сведение в диапазон 1..12 суммой цифр (12 остаётся 12)
  if (n<=12) return n;
  let s = n.toString().split('').reduce((a,b)=>a+ +b,0);
  while (s>12) s = s.toString().split('').reduce((a,b)=>a+ +b,0);
  return s;
};
const wrap12 = n => { // для П4..П6: сворачиваем, но 12 допустимо
  while (n>12) n-=12;
  return n;
};
const digitRoot = n => { // обычная сумма цифр
  let s = n;
  while (s>9) s = s.toString().split('').reduce((a,b)=>a+ +b,0);
  return s;
};
const colorClass = v => `c${v}`;

/* ======= алгоритм матрицы ======= */
/* П1=сумма цифр дня; П2=сумма цифр месяца; П3=сумма цифр года -> до ≤12
   П4=П1+П2 (wrap12); П5=П1+П3 (wrap12); П6=П2+П3 (wrap12)
   П7= digitRoot(П4+П5); П8= digitRoot(П4+П6); П9= digitRoot(П5+П6)
   П10=П7+П8; П11=П9+П7; П12=П8+П9 (без свертки — по примерам всё в диапазоне)
*/
function buildMatrix(dateStr){
  const d = new Date(dateStr);
  const day = d.getUTCDate(), month = d.getUTCMonth()+1, year = d.getUTCFullYear();
  const s = n => n.toString().split('').reduce((a,b)=>a+ +b,0);
  const reduce12 = n => { let x=s(n); while (x>12) x=s(x); return x; };

  const P1 = reduce12(day);
  const P2 = reduce12(month);
  const P3 = reduce12(year);

  const P4 = wrap12(P1+P2);
  const P5 = wrap12(P1+P3);
  const P6 = wrap12(P2+P3);

  const P7 = digitRoot(P4+P5);
  const P8 = digitRoot(P4+P6);
  const P9 = digitRoot(P5+P6);

  const P10 = P7+P8;
  const P11 = P9+P7;
  const P12 = P8+P9;

  return {P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12};
}

/* ======= вычисления кодов ======= */
function computeAll(dateStr){
  const M = buildMatrix(dateStr);

  // Высшее Я (по твоей формуле: День+Месяц+ (19/20 + десятилетие+год свёрнутый до 9))
  // В твоём проекте мы показываем просто сумму цифр даты без сворачивания столетия:
  const vy = (()=>{ // версия, принятная нами ранее
    const [y,m,d] = dateStr.split('-').map(Number);
    return (d%100) + (m%100) + (Math.floor(y/100)) + (Math.floor((y%100)/10)) + (y%10);
  })();

  // дыхания
  const N1 = M.P5;                      // «Свет–Любовь»
  const N2 = M.P8;                      // «Сила–Воля»
  const N3 = ds(M.P5 + M.P8);           // простукивание

  // торсионное
  const T1 = ds(M.P8 + M.P10 + M.P12);
  const T2 = ds(M.P1 + M.P3 + M.P5);
  const T3 = ds(T1 + T2);

  // тело света
  const C1 = ds(M.P2 + M.P4 + M.P6);
  const C2 = ds(M.P7 + M.P9 + M.P11);
  const C3 = ds(C1 + C2);

  return {M, vy, N1,N2,N3, T1,T2,T3, C1,C2,C3};
}

/* ======= рендер ======= */
function render(dateStr){
  const {M,vy,N1,N2,N3,T1,T2,T3,C1,C2,C3} = computeAll(dateStr);

  // заголовки/перевод
  byId('title').innerHTML = tr[LANG].title;
  byId('t_birthdate').textContent = tr[LANG].birthdate;
  byId('t_language').textContent = tr[LANG].language;
  byId('btnCalc').textContent = tr[LANG].calc;
  byId('btnPdf').textContent = tr[LANG].pdf;

  // ВЫ
  byId('vyBadge').textContent = tr[LANG].vy(vy);

  // матрица
  const order = [
    ['P10',M.P10],['P11',M.P11],['P12',M.P12],
    ['P7',M.P7],['P8',M.P8],['P9',M.P9],
    ['P4',M.P4],['P5',M.P5],['P6',M.P6],
    ['P1',M.P1],['P2',M.P2],['P3',M.P3],
  ];
  const mDiv = byId('matrix');
  mDiv.innerHTML = order.map(([,v]) => `<div class="cell ${colorClass(v)}">${v}</div>`).join('');

  // коды
  const codesDiv = byId('codes');
  codesDiv.innerHTML = `
    <h3>${tr[LANG].codesTitle}</h3>
    ${tr[LANG].codeLine(tr[LANG].torsion, T1,T2,T3)}
    ${tr[LANG].codeLine(tr[LANG].light,   C2,C1,C3)}
    ${tr[LANG].codeLine(tr[LANG].soul,    M.P3, M.P5, M.P11)}
  `;

  // инструкция
  const how = byId('howto');
  how.innerHTML = `
    <h3>${tr[LANG].howtoTitle}</h3>
    <p><b>${tr[LANG].a1}</b><br>
      ${tr[LANG].a1_1(N1)}<br>
      ${tr[LANG].a1_2(N2)}<br>
      ${tr[LANG].a1_3(N3)}
    </p>
    <p><b>${tr[LANG].a2}</b><br>
      ${tr[LANG].a2_1(T1)}<br>
      ${tr[LANG].a2_2(T2)}<br>
      ${tr[LANG].a2_3(T3)}
    </p>
    <p><b>${tr[LANG].a3}</b><br>
      ${tr[LANG].a3_1(C1)}<br>
      ${tr[LANG].a3_2(C2)}<br>
      ${tr[LANG].a3_3(C3)}
    </p>
    <p class="muted">${LANG==='ru'
      ? 'Пояснение: все величины сведены к диапазону 1–12 суммированием цифр (12 допустимо как есть).'
      : 'Note: all values are reduced to 1–12 by summing digits (12 stays as is).'
    }</p>
  `;
}

/* ======= PDF ======= */
async function makePdf(dateStr){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({unit:'pt',format:'a4'});
  const pad = 44;
  let y = pad;

  const titleTxt = byId('title').textContent.replace(/\s+/g,' ');
  doc.setFont('helvetica','bold'); doc.setFontSize(22);
  doc.text(titleTxt, pad, y); y += 24;

  doc.setFontSize(12); doc.setFont('helvetica','normal');
  const dateLabel = tr[LANG].dateLabel + ': ' + dateStr.split('-').reverse().join('.');
  doc.text(dateLabel, pad, y); y += 12;

  const vyText = byId('vyBadge').textContent;
  doc.text(vyText, pad, y); y += 18;

  // коды (как на экране)
  const codes = byId('codes').innerText.split('\n');
  y += 10; doc.setFont('helvetica','bold'); doc.text(tr[LANG].codesTitle, pad, y); y+=14;
  doc.setFont('helvetica','normal');
  codes.forEach(line=>{ doc.text(line, pad, y); y+=14; });

  // инструкция
  y += 10; doc.setFont('helvetica','bold'); doc.text(tr[LANG].howtoTitle, pad, y); y+=16;
  doc.setFont('helvetica','normal');
  const howLines = byId('howto').innerText.split('\n');
  howLines.forEach(line=>{
    const chunk = doc.splitTextToSize(line, 520);
    doc.text(chunk, pad, y);
    y += 14 * chunk.length;
    if(y>780){ doc.addPage(); y=pad; }
  });

  const file = tr[LANG].pdfFile(dateStr.replaceAll('-',''));
  doc.save(file);
}

/* ======= init & события ======= */
const dateInput = byId('date');
const langSel   = byId('lang');

function todayISO(){ const d=new Date(); const z=n=>String(n).padStart(2,'0'); return `${d.getFullYear()}-${z(d.getMonth()+1)}-${z(d.getDate())}`; }

function ensureDate(){
  if(!dateInput.value){
    // авто-подстановка примера из селектора даты (на некоторых мобилах пусто до выбора)
    dateInput.value = todayISO();
  }
}

function doCalc(){
  ensureDate();
  render(dateInput.value);
}

byId('btnCalc').addEventListener('click', doCalc);
byId('btnPdf').addEventListener('click', ()=>{
  ensureDate(); makePdf(dateInput.value);
});
langSel.addEventListener('change', ()=>{
  LANG = langSel.value; doCalc();
});

// старт: язык по браузеру, дата — сегодня/или оставить пустой до выбора
(function boot(){
  const nav = (navigator.language||'en').toLowerCase();
  LANG = nav.startsWith('ru') ? 'ru' : 'en';
  langSel.value = LANG;
  // если хочешь предзаполнить конкретной датой — раскомментируй строку ниже
  // dateInput.value = '1969-05-22';
  // рендер пустых панелей до расчёта не нужен — сразу ждём «Рассчитать»
})();
</script>
</body>
</html>
